<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the compute nodes &mdash; UPPMAX intro course — part 1 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/sphinx_lesson.css" type="text/css" />
      <link rel="stylesheet" href="_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Working on UPPMAX" href="working.html" />
    <link rel="prev" title="Software and tools" href="software.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> UPPMAX intro course — part 1
            <img src="_static/c_242915-l_3-k_svg-uu-logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro_online.html">Welcome on-line!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="login2.html">Login</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_cases.html">Linux and basic toolkit</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More about UPPMAX</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview2.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing — HPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="naiss.html">NAISS and projects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using UPPMAX</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="software.html">Software and tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using the compute nodes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-compute-nodes">The compute nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slurm-sbatch-the-job-queue">Slurm, sbatch, the job queue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#jobs">Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slurm-parameters">Slurm parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-queue">The queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-hours">Core-hours</a></li>
<li class="toctree-l3"><a class="reference internal" href="#choices">Choices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-kind-of-compute-work-are-you-doing">What kind of compute work are you doing?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#walltime-at-the-different-clusters">Walltime at the different clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-jobs">Interactive jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#try-interactive-and-run-rstudio">Try interactive and run RStudio</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#job-scripts-batch">Job scripts (batch)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#try-batch-job">Try batch job</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#a-simple-job-script-template">A simple job script template</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-slurm-tools">Other Slurm tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercises">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="#links">Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="working.html">Working on UPPMAX</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NAISS SENS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bianca.html">NAISS SENS and Bianca</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Courses and workshops</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="courses.html">Courses and workshops</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Summary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UPPMAX intro course — part 1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Using the compute nodes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/slurm_intro.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="using-the-compute-nodes">
<h1>Using the compute nodes<a class="headerlink" href="#using-the-compute-nodes" title="Permalink to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>This is a short introduction in how to reach the compute nodes</p></li>
<li><p>Wednesday afternoon is wedded to this topic!</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>Approx timing: 13.30-14.30 (10 min break)</p></li>
<li><p>Theory</p></li>
<li><p>Hands-on</p></li>
</ul>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<ul class="simple">
<li><p>For now, <strong>this course</strong>, we use the <strong>material on this present page</strong>.</p></li>
<li><p>A SLURM introduction can otherwise be found here: <a class="reference external" href="http://docs.uppmax.uu.se/cluster_guides/slurm/">http://docs.uppmax.uu.se/cluster_guides/slurm/</a></p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>project number: <code class="docutils literal notranslate"><span class="pre">naiss2024-22-49</span></code></p></li>
</ul>
</div>
<section id="the-compute-nodes">
<h2>The compute nodes<a class="headerlink" href="#the-compute-nodes" title="Permalink to this heading"></a></h2>
<p>When you are logged in, you are on a login node.
There are two types of nodes:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Purpose</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Login node</p></td>
<td><p>Start jobs for worker nodes, do easy things.</p></td>
</tr>
<tr class="row-odd"><td><p>Compute nodes</p></td>
<td><p>Do hard calculations, either from scripts of an interactive session.</p></td>
</tr>
</tbody>
</table>
<img src="_images/mermaid-046a34d4a7c3df57cf3899fe2f612f27a718b9e9.png" alt="graph TB

  Node1 -- interactive --&gt; SubGraph2Flow
  Node1 -- sbatch --&gt; SubGraph2Flow
  subgraph &quot;Snowy&quot;
  SubGraph2Flow(calculation nodes) 
        end

        thinlinc -- usr-sensXXX + 2FA + VPN ----&gt; SubGraph1Flow
        terminal/thinlinc -- usr --&gt; Node1
        terminal -- usr-sensXXX + 2FA + VPN ----&gt; SubGraph1Flow
        Node1 -- usr-sensXXX + 2FA + no VPN ----&gt; SubGraph1Flow
        
        subgraph &quot;Bianca&quot;
        SubGraph1Flow(Bianca login) -- usr+passwd --&gt; private(private cluster)
        private -- interactive --&gt; calcB(calculation nodes)
        private -- sbatch --&gt; calcB
        end

        subgraph &quot;Rackham&quot;
        Node1[Login] -- interactive --&gt; Node2[calculation nodes]
        Node1 -- sbatch --&gt; Node2
        end" />
</section>
<section id="slurm-sbatch-the-job-queue">
<h2>Slurm, sbatch, the job queue<a class="headerlink" href="#slurm-sbatch-the-job-queue" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Problem: <em>1000 users, 300 nodes, 5000 cores</em></p></li>
<li><p>We need a <strong>queue</strong>:</p>
<ul>
<li><p><a class="reference external" href="https://slurm.schedmd.com/">Slurm</a> is a job scheduler</p></li>
</ul>
</li>
<li><p>You define <strong>jobs</strong> to be run on the compute nodes and therefore sent to the queue.</p></li>
</ul>
<section id="jobs">
<h3>Jobs<a class="headerlink" href="#jobs" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Job = what happens during booked time</p></li>
<li><p>Described in</p>
<ul>
<li><p>a script file or</p></li>
<li><p>the command-line (priority over script)</p></li>
</ul>
</li>
<li><p>The definitions of a job:</p>
<ul>
<li><p>Slurm parameters (<strong>flags</strong>)</p></li>
<li><p>Load software modules</p></li>
<li><p>(Navigate in file system)</p></li>
<li><p>Run program(s)</p></li>
<li><p>(Collect output)</p></li>
<li><p>… and more</p></li>
</ul>
</li>
</ul>
<div class="admonition-some-keywords admonition">
<p class="admonition-title">“Some keywords”</p>
<ul class="simple">
<li><p>A program may run <em>serially</em> and then needs only ONE <em>compute thread</em>, which will occupy 1 core, which is a physical unit of the CPU on the node.</p>
<ul>
<li><p>You should most often just book 1 core. If you require more than 7 GB you can allocate more cores and you will get multiples of 7 GB.</p></li>
</ul>
</li>
<li><p>A program may run in <em>parallel</em> and then needs either several <em>threads</em> or several <em>tasks</em>, both occupying several cores.</p>
<ul>
<li><p>If you need all 128 GB RAM (actually 112) or all 16 cores for your job, book a complete node.</p></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="slurm-parameters">
<h3>Slurm parameters<a class="headerlink" href="#slurm-parameters" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>1 mandatory setting for jobs:</p>
<ul>
<li><p>Which compute project? (<code class="docutils literal notranslate"><span class="pre">-A</span></code>)</p></li>
</ul>
</li>
<li><p>3 settings you really should set:</p>
<ul>
<li><p>Type of queue or partition? (<code class="docutils literal notranslate"><span class="pre">-p</span></code>)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">core</span></code>  for most jobs and <strong>default</strong>!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code>  for larger jobs</p></li>
<li><p>for short development jobs and tests: <code class="docutils literal notranslate"><span class="pre">devcore</span></code>, <code class="docutils literal notranslate"><span class="pre">devel</span></code>)</p></li>
</ul>
</li>
<li><p>How many cores? (<code class="docutils literal notranslate"><span class="pre">-n</span></code>)</p>
<ul>
<li><p>up to 16 for core job</p></li>
</ul>
</li>
<li><p>How long at most? (<code class="docutils literal notranslate"><span class="pre">-t</span></code>)</p></li>
</ul>
</li>
<li><p>If in doubt:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">core</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">10-00:00:00</span></code></p></li>
</ul>
</li>
</ul>
</section>
<section id="the-queue">
<h3>The queue<a class="headerlink" href="#the-queue" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>How does the queue work?</p></li>
<li><p>Let’s look graphically at jobs presently running.</p></li>
</ul>
<p><img alt="Image" src="_images/queue1.png" /></p>
<ul class="simple">
<li><p><em>x-axis: cores, one thread per core</em></p></li>
<li><p><em>y-axis: time</em>
<br/><br/></p></li>
<li><p>We see some holes where we may fit jobs already!</p></li>
<li><p>Let’s see which type of jobs that can fit!</p></li>
</ul>
<p><img alt="Image" src="_images/queue2.png" /></p>
<br>
<ul class="simple">
<li><p>4 one-core jobs can run immediately (or a 4-core wide job).</p>
<ul>
<li><p><em>The jobs are too long to fit at core number 9-13.</em></p></li>
</ul>
</li>
</ul>
<p><img alt="Image" src="_images/queue3.png" />
<br></p>
<ul class="simple">
<li><p>A five-core job has to wait.</p>
<ul>
<li><p><em>Too long to fit in cores 9-13 and too wide to fit in the last cores.</em></p></li>
</ul>
</li>
<li><p>Easiest to schedule <em>single-threaded</em>, short jobs</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul class="simple">
<li><p>You don’t see the queue graphically, however.</p></li>
<li><p>But, overall:</p>
<ul>
<li><p>short and narrow jobs will start fast</p></li>
<li><p>test and development jobs can get use of specific development nodes if they are shorter than 1 hour and uses up to two nodes.</p></li>
<li><p>waste of resources unless you have a parallel program or need all the memory, e.g. 128 GB per node</p></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="core-hours">
<h3>Core-hours<a class="headerlink" href="#core-hours" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Remember that you are charged CPU-hours according to booked #cores x hours</p></li>
<li><p>Example 1: 60 hours with 2 cores = 120 CPU-hours</p></li>
<li><p>Example 2: 12 hours with a full node = 192 hours</p>
<ul>
<li><p>Waste of resources unless you have a parallel program using all cores or need all the memory, e.g. 128 GB per node</p></li>
</ul>
</li>
</ul>
</section>
<section id="choices">
<h3>Choices<a class="headerlink" href="#choices" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Work interactively with your data or develop or test</p>
<ul>
<li><p>Run an <strong>Interactive session</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">interactive</span> <span class="pre">&lt;flags&gt;</span> <span class="pre">...</span></code></p></li>
</ul>
</li>
<li><p>If you <em>don’t</em> need any live interaction with your workflow/analysis/simulation</p>
<ul>
<li><p>Send your job to the slurm job batch (sbatch)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sbatch</span> <span class="pre">&lt;flags&gt;</span> <span class="pre">&lt;program&gt;</span></code> or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sbatch</span> <span class="pre">&lt;job</span> <span class="pre">script&gt;</span></code></p></li>
</ul>
</li>
</ul>
<img src="_images/mermaid-b59416dfac2620d7679ac3fa5aece5f05e93534a.png" alt="flowchart TD
    UPPMAX(What to run on which node?)
    operation_type{What type of operation/calculation?}
    interaction_type{What type of interaction?}
    login_node(Work on login node)
    interactive_node(Work on interactive node)
    calculation_node(Schedule for calculation node)

    UPPMAX--&gt;operation_type
    operation_type--&gt;|light,short|login_node
    operation_type--&gt;|heavy,long|interaction_type
    interaction_type--&gt;|Direct|interactive_node
    interaction_type--&gt;|Indirect|calculation_node" />
</section>
<section id="what-kind-of-compute-work-are-you-doing">
<h3>What kind of compute work are you doing?<a class="headerlink" href="#what-kind-of-compute-work-are-you-doing" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Compute bound</strong></p>
<ul>
<li><p>you use mainly CPU power</p></li>
<li><p>does the software support threads or MPI?</p>
<ul>
<li><p><strong>Threads/openMP</strong> are rather often supported. <strong>Use several cores!</strong></p></li>
<li><p><strong>MPI</strong> (Message Passing Interface) allows for inter-node jobs but are seldom supported for bioinformatics software. <strong>You could use several nodes!</strong></p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Memory bound</strong></p>
<ul>
<li><p>if the bottlenecks are allocating memory, copying/duplicating</p></li>
<li><p>use more cores up to 1 node, perhaps using a “fat” node.</p></li>
</ul>
</li>
</ul>
<div class="admonition-slurm-cheat-sheet admonition">
<p class="admonition-title">“Slurm Cheat Sheet”</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-A</span></code>    project number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code>    wall time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>    number of cores</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span></code>    number of nodes (can only be used if your code is parallelized with MPI)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span></code>    partition</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">core</span></code> is default and works for jobs narrower than 16 cores</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code> can be used if you need the whole node and its memory</p></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="walltime-at-the-different-clusters">
<h3>Walltime at the different clusters<a class="headerlink" href="#walltime-at-the-different-clusters" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Rackham: 10 days</p></li>
<li><p>Snowy: 30 days</p></li>
<li><p>Bianca: 10 days</p></li>
</ul>
</section>
</section>
<section id="interactive-jobs">
<h2>Interactive jobs<a class="headerlink" href="#interactive-jobs" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Most work is most effective as submitted jobs, but e.g. development needs responsiveness</p></li>
<li><p>Interactive jobs are high-priority but limited in <code class="docutils literal notranslate"><span class="pre">-n</span></code> and <code class="docutils literal notranslate"><span class="pre">-t</span></code></p></li>
<li><p>Quickly give you a job and logs you in to the compute node</p></li>
<li><p>Require same Slurm parameters as other jobs</p></li>
<li><p>Log in to compute node</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">interactive</span> <span class="pre">...</span></code></p></li>
</ul>
</li>
<li><p>Logout with <code class="docutils literal notranslate"><span class="pre">&lt;Ctrl&gt;-D</span></code> or <code class="docutils literal notranslate"><span class="pre">logout</span></code></p></li>
<li><p>To use an interactive node, in a terminal, type:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>interactive<span class="w"> </span>-A<span class="w"> </span><span class="o">[</span>project<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>-p<span class="w"> </span>core<span class="w"> </span>-n<span class="w"> </span><span class="o">[</span>number_of_cores<span class="o">]</span><span class="w"> </span>-t<span class="w"> </span><span class="o">[</span>session_duration<span class="o">]</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>interactive<span class="w"> </span>-A<span class="w"> </span>naiss2024-22-49<span class="w"> </span>-p<span class="w"> </span>core<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>-t<span class="w"> </span><span class="m">8</span>:0:0
</pre></div>
</div>
<p>This starts an interactive session using project <code class="docutils literal notranslate"><span class="pre">naiss2024-22-49</span></code>
that uses 2 cores and has a maximum duration of 8 hours.</p>
<section id="try-interactive-and-run-rstudio">
<h3>Try interactive and run RStudio<a class="headerlink" href="#try-interactive-and-run-rstudio" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>We recommend using at least two cores for RStudio, and to get those resources, you must start an interactive job.</p></li>
</ul>
<div class="admonition-type-along type-along important admonition" id="type-along-0">
<p class="admonition-title">Type-Along</p>
<ul>
<li><p>Use <strong>ThinLinc</strong></p></li>
<li><p>Start <strong>interactive session</strong> on compute node (2 cores)</p></li>
<li><p>If you already have an interactive session going on use that.</p>
<ul class="simple">
<li><p>If you don’t find it, do</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">squeue</span></code></p>
<ul class="simple">
<li><p>find your session, ssh to it, like:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ssh</span> <span class="pre">r483</span></code></p>
</li>
<li><p>If you have no ongoing session:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">interactive</span> <span class="pre">-A</span> <span class="pre">naiss2024-22-49</span> <span class="pre">-p</span> <span class="pre">devcore</span> <span class="pre">-n</span> <span class="pre">2</span> <span class="pre">-t</span> <span class="pre">60:00</span></code></p>
<ul>
<li><p>Once the interactive job has begun you need to load needed modules, even if you had loaded them before in the login node</p></li>
<li><p>You can check which node you are on?</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">hostname</span></code></p>
</li>
<li><p>Also try:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">srun</span> <span class="pre">hostname</span></code></p>
<ul class="simple">
<li><p>This will give several output lines resembling the number of cores you allocated.</p></li>
<li><p>How many in this case??</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">[bjornc&#64;r483</span> <span class="pre">~]$</span></code></p>
</li>
<li><p>Load an RStudio module and an R_packages module (if not loading R you will have to stick with R/3.6.0) and run “rstudio” from there.</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ml</span> <span class="pre">R_packages/4.2.1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ml</span> <span class="pre">RStudio/2022.07.1-554</span></code></p>
</li>
<li><p><strong>Start rstudio</strong>, keeping terminal active (<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>)</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">rstudio</span> <span class="pre">&amp;</span></code></p>
</li>
<li><p>Slow to start?</p></li>
<li><p>Depends on:</p>
<ul class="simple">
<li><p>number of packages</p></li>
<li><p>if you save a lot of data in your RStudio workspace, to be read during start up.</p></li>
</ul>
</li>
<li><p><strong>Quit RStudio</strong>!</p></li>
<li><p><strong>Log out</strong> from interactive session with <code class="docutils literal notranslate"><span class="pre">&lt;Ctrl&gt;-D</span></code> or <code class="docutils literal notranslate"><span class="pre">logout</span></code> or <code class="docutils literal notranslate"><span class="pre">exit</span></code></p></li>
</ul>
</div>
</section>
</section>
<section id="job-scripts-batch">
<h2>Job scripts (batch)<a class="headerlink" href="#job-scripts-batch" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Batch scripts can be written in any scripting language. We will use BASH</p></li>
<li><p>Make first line be  <code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code> in the top line</p>
<ul>
<li><p>It is good practice to end the line with <code class="docutils literal notranslate"><span class="pre">-l</span></code> to reload a fresh environment with no modules loaded.</p></li>
<li><p>This makes you sure that you don’t enable other software or versions that may interfere with what you want to do in the job.</p></li>
</ul>
</li>
<li><p>Before the job content, add the batch flags starting the lines with the keyword <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code>, like:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">-t</span> <span class="pre">2:00:00</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">-p</span> <span class="pre">core</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#SBATCH</span> <span class="pre">-n</span> <span class="pre">3</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">#</span></code> will be ignored by <code class="docutils literal notranslate"><span class="pre">bash</span></code> and can run as an ordinary bash script</p></li>
<li><p>if running the script with the command <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">&lt;script&gt;</span></code> the <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> lines will be interpreted as slurm flags</p></li>
</ul>
<section id="try-batch-job">
<h3>Try batch job<a class="headerlink" href="#try-batch-job" title="Permalink to this heading"></a></h3>
<div class="admonition-type-along type-along important admonition" id="type-along-1">
<p class="admonition-title">Type-Along</p>
<ul class="simple">
<li><p>Write a bash script called <code class="docutils literal notranslate"><span class="pre">jobscript.sh</span></code></p>
<ul>
<li><p>You can be in your <code class="docutils literal notranslate"><span class="pre">~</span></code> folder</p></li>
</ul>
</li>
<li><p>To make it more efficient Copy-paste the code below.</p></li>
</ul>
</div>
<section id="a-simple-job-script-template">
<h4>A simple job script template<a class="headerlink" href="#a-simple-job-script-template" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH -A naiss2024-22-49  # Project ID</span>

<span class="c1">#SBATCH -p devcore  # Asking for cores (for test jobs and as opposed to multiple nodes) </span>

<span class="c1">#SBATCH -n 1  # Number of cores</span>

<span class="c1">#SBATCH -t 00:10:00  # Ten minutes</span>

<span class="c1">#SBATCH -J Template_script  # Name of the job</span>

<span class="c1"># go to some directory</span>

<span class="nb">cd</span><span class="w"> </span>/proj/naiss2024-22-49/
<span class="nb">pwd</span><span class="w"> </span>-P

<span class="c1"># load software modules</span>

module<span class="w"> </span>load<span class="w"> </span>bioinfo-tools
module<span class="w"> </span>list

<span class="c1"># do something</span>

<span class="nb">echo</span><span class="w"> </span>Hello<span class="w"> </span>world!<span class="w">  </span>
</pre></div>
</div>
<ul>
<li><p>Run it:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">sbatch</span> <span class="pre">jobscript.sh</span></code></p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Do you need more resources?</strong></p>
<p>Do you need more memory than 128 GB or GPU:s?</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">mem256GB</span></code> allocate a fat node with 256 GB RAM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">mem512GB</span></code> allocate a fat node with 512 GB RAM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">gpu</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">node</span></code> must be used when allocating these nodes</p></li>
<li><p>GPU example asking for a node, using one GPU and 3 CPU cores. TIP: ask always for more than one hour!</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">interactive</span> <span class="pre">-A</span> <span class="pre">&lt;proj&gt;</span> <span class="pre">-n</span> <span class="pre">3</span> <span class="pre">-C</span> <span class="pre">gpu</span> <span class="pre">--gres=gpu:1</span> <span class="pre">-t</span> <span class="pre">01:10:00</span></code></p></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Some Limits</strong></p>
<ul class="simple">
<li><p>There is a job wall time limit of ten days (<strong>240 hours</strong>).</p></li>
<li><p>We restrict each user to at most 5000 running and waiting jobs in total.</p></li>
<li><p>Each project has a 30 days running allocation of CPU hours.</p>
<ul>
<li><p>We do not forbid running jobs after the allocation is over-drafted</p></li>
<li><p>Instead allow to submit jobs with a very low queue priority, so that you may be able to run your jobs anyway, if a sufficient number of nodes happens to be free on the system.</p></li>
</ul>
</li>
</ul>
</div>
</section>
</section>
</section>
<section id="other-slurm-tools">
<h2>Other Slurm tools<a class="headerlink" href="#other-slurm-tools" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">squeue</span></code> — quick info about jobs in queue</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jobinfo</span></code> — detailed info about jobs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">finishedjobinfo</span></code> — summary of finished jobs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jobstats</span></code> — efficiency of booked resources</p>
<ul>
<li><p>use <code class="docutils literal notranslate"><span class="pre">eog</span></code> to watch the <code class="docutils literal notranslate"><span class="pre">png</span></code> output files</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">bianca_combined_jobinfo</span></code></p></li>
</ul>
<div class="admonition-slurm-cheat-sheet admonition">
<p class="admonition-title">“Slurm Cheat Sheet”</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-A</span></code>    project number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code>    wall time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>    number of cores</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span></code>    number of nodes (can only be used if your code is parallelized with MPI)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span></code>    partition</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">core</span></code> is default and works for jobs narrower than 16 cores</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">node</span></code> can be used if you need the whole node and its memory</p>
<ul>
<li><p>must be used when allocating the fat nodes, see below</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">mem256GB</span></code> allocate a fat node with 256 GB RAM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">mem512GB</span></code> allocate a fat node with 512 GB RAM</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">gpu</span></code></p></li>
</ul>
<p><strong>Batch jobs</strong></p>
<ul class="simple">
<li><p>Two alternatives</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">&lt;jobscript</span> <span class="pre">with</span> <span class="pre">all</span> <span class="pre">#SBATCH</span> <span class="pre">options&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">&lt;options</span> <span class="pre">that</span> <span class="pre">will</span> <span class="pre">be</span> <span class="pre">prioritized</span> <span class="pre">over</span> <span class="pre">the</span> <span class="pre">options</span> <span class="pre">within</span> <span class="pre">the</span> <span class="pre">jobs</span> <span class="pre">script&gt;</span> <span class="pre">&lt;jobscript&gt;</span></code></p>
<ul>
<li><p>can for instance be used if you just want to test with, for instance, fewer cores and shorter time</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">-t</span>&#160; <span class="pre">60:00</span> <span class="pre">-p</span> <span class="pre">devcore</span> <span class="pre">-n</span> <span class="pre">2</span> <span class="pre">job.sh</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Interactive</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">interactive</span> <span class="pre">-A</span> <span class="pre">&lt;project&gt;</span> <span class="pre">&lt;other</span> <span class="pre">options</span> <span class="pre">if</span> <span class="pre">not</span> <span class="pre">using</span> <span class="pre">default</span> <span class="pre">settings&gt;</span></code></p></li>
<li><p>load your modules when session starts</p></li>
</ul>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading"></a></h2>
<div class="admonition-why-not-always-use-an-interactive-session exercise important admonition" id="exercise-0">
<p class="admonition-title">“Why not always use an interactive session?”</p>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<ul class="simple">
<li><p>Because it is an inefficient use of your core hours.</p></li>
<li><p>An interactive session means that you use a calculation node with low efficiency: only irregularly you will use such a node to its full
capacity.</p></li>
<li><p>However, the number of core hours are registered as if the node is used at full capacity, as it is <em>reserved</em> to be used at that capacity.</p></li>
</ul>
</div>
</div>
<div class="admonition-which-approach-is-best-in-the-following-use-cases-batch-jobs-or-interactive-sessions exercise important admonition" id="exercise-1">
<p class="admonition-title">“Which approach is best in the following use cases? Batch jobs or interactive sessions?”</p>
<ol class="arabic simple">
<li><p>Long jobs</p></li>
<li><p>Short jobs with interactive “run-time”/interactive user input</p></li>
<li><p>Short jobs without interactive “run-time”/interactive user input</p></li>
<li><p>Test/debugging/developing code</p></li>
<li><p>Playing with and plotting large data</p></li>
</ol>
</div>
<div class="admonition-answer solution important dropdown admonition" id="solution-1">
<p class="admonition-title">“Answer”</p>
<ol class="arabic simple">
<li><p>batch</p></li>
<li><p>interactice</p></li>
<li><p>batch</p></li>
<li><p>interactive</p></li>
<li><p>interactive</p></li>
</ol>
</div>
</section>
<section id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://slurm.schedmd.com/">Slurm documentation</a></p></li>
<li><p><a class="reference external" href="https://www.uppmax.uu.se/support/user-guides/slurm-user-guide/">Slurm user guide</a></p></li>
<li><p><a class="reference external" href="https://www.uppmax.uu.se/support/user-guides/jobstats-user-guide/">Discovering job resource usage with <code class="docutils literal notranslate"><span class="pre">jobstats</span></code></a></p></li>
<li><p><a class="reference external" href="https://www.uppmax.uu.se/support/user-guides/plotting-your-core-hour-usage/">Plotting your core hour usage</a></p></li>
</ul>
<div class="admonition-exercise-at-home homework important admonition" id="homework-0">
<p class="admonition-title">Exercise at home</p>
<ul class="simple">
<li><p>Copy the code just further up!</p></li>
<li><p>Put it into a file named “jobtemplate.sh”</p></li>
<li><p>Make the file executable (chmod)</p></li>
<li><p>Submit the job:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>jobtemplate.sh
</pre></div>
</div>
<ul class="simple">
<li><p>Note the job id!</p></li>
<li><p>Check the queue:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>squeue<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;
<span class="gp">$ </span>jobinfo<span class="w"> </span>-u<span class="w"> </span>&lt;username&gt;
</pre></div>
</div>
<ul class="simple">
<li><p>When it’s done (rather fast), look for the output file (slurm-<jobid>.out):</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls<span class="w"> </span>-lrt<span class="w"> </span>slurm-*
</pre></div>
</div>
<ul class="simple">
<li><p>Check the output file to see if it ran correctly</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cat<span class="w"> </span>&lt;filename&gt;
</pre></div>
</div>
</div>
<p><strong>More on Wednesday afternoon!</strong></p>
<div class="admonition-keypoints keypoints admonition" id="keypoints-0">
<p class="admonition-title">Keypoints</p>
<ul class="simple">
<li><p>You are always in the login node unless you:</p>
<ul>
<li><p>start an interactive session to do development or hands-on work</p></li>
<li><p>start a batch job to run jobs not needing any manual input</p></li>
</ul>
</li>
<li><p>Slurm is a job scheduler</p>
<ul>
<li><p>add flags to describe your job.</p></li>
</ul>
</li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="software.html" class="btn btn-neutral float-left" title="Software and tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="working.html" class="btn btn-neutral float-right" title="Working on UPPMAX" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright UPPMAX.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>